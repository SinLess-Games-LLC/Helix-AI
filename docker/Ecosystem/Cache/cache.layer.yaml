services:
  redis:
    image: redis/redis-stack-server:7.4.0-v0
    container_name: redis
    hostname: redis
    deploy:
      resources:
        limits:
          memory: 500m
          cpus: "0.5"
    environment:
      REDIS_PASSWORD: ${REDIS_PASSWORD:-your_secure_password}
    command: [
      "redis-server",
      "--requirepass", "${REDIS_PASSWORD}",
      "--appendonly", "yes",       # Enable AOF persistence
      "--save", "900", "1",        # Save snapshot every 15 minutes if at least 1 key changed
      "--save", "300", "10",       # Save snapshot every 5 minutes if at least 10 keys changed
      "--save", "60", "10000",     # Save snapshot every 1 minute if at least 10,000 keys changed
      "--bind", "0.0.0.0"          # Allow connections from any IP (ensure proper network security)
    ]
    volumes:
      - redis_data:/data

  redis-exporter:
    image: oliver006/redis_exporter:v1.0.3
    container_name: redis-exporter
    hostname: redis-exporter
    command:
      - '--redis.addr=redis://redis:6379'
      - '--redis.password=${REDIS_PASSWORD}'

  redisinsight:
    image: redis/redisinsight:latest
    container_name: redisinsight
    environment:
      REDISINSIGHT_REDIS_URI: redis://redis:6379
