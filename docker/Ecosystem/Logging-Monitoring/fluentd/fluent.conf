# ==========================================
# ==                                      ==
# ==             Health Check             ==
# ==                                      ==
# ==========================================

# HTTP input plugin for health check endpoint
<source>
  @type http
  @id health_check_input_http
  port 9881
  bind 0.0.0.0
  # Health check endpoint to ensure Fluentd is running
</source>

# Health check output to stdout
<match health_check>
  @type stdout
  # Outputs health check results to stdout
</match>

# ==========================================
# ==                                      ==
# ==               Inputs                 ==
# ==                                      ==
# ==========================================

# Forward input plugin to receive logs from Fluentd forwarders
<source>
  @type forward
  @id input_forward
  port 24224
  bind 0.0.0.0
  # Listens on port 24224 for Fluentd forward input
  # Used for collecting logs from other Fluentd agents or sources
</source>

# HTTP input plugin to receive logs via HTTP POST
<source>
  @type http
  @id input_http_logs
  port 9880
  bind 0.0.0.0
  # Listens on port 9880 for HTTP input
  # Allows applications to send logs directly via HTTP POST requests
</source>

# Syslog input plugin to receive logs from syslog clients
<source>
  @type syslog
  @id input_syslog
  port 5140
  bind 0.0.0.0
  # Listens on port 5140 for Syslog input
  # Receives logs from devices and applications that send logs using the syslog protocol
</source>

# Additional syslog source specifically for Vault
<source>
  @type syslog
  port 514
  bind 0.0.0.0
  tag vault.syslog
  # Listens on port 514 for syslog input specific to Vault
  # Uses a specific tag to differentiate these logs
</source>

# ==========================================
# ==                                      ==
# ==               OUTPUTS                ==
# ==                                      ==
# ==========================================

# Output to stdout for debugging purposes
<match **>
  @type stdout
  # Prints all incoming logs to stdout for debugging and verification
</match>

# Send all logs to Elasticsearch
<match **>
  @type elasticsearch
  host elastic
  port 9200
  user fluentd
  password admin
  scheme https
  logstash_format true
  logstash_prefix fluentd
  logstash_dateformat %Y.%m.%d
  include_tag_key true
  tag_key @log_name
  ssl_verify false
  ssl_version TLSv1_2
  # Sends all logs to Elasticsearch
  # Logs are formatted to be compatible with Logstash and stored with a prefix of 'fluentd'
  # SSL is used for secure communication with Elasticsearch
</match>

# Specific Kibana logs to Elasticsearch
<match kibana.**>
  @type elasticsearch
  host elastic
  port 9200
  user fluentd
  password admin
  scheme https
  logstash_format true
  logstash_prefix kibana
  logstash_dateformat %Y.%m.%d
  include_tag_key true
  tag_key @log_name
  ssl_verify false
  ssl_version TLSv1_2
  # Sends logs tagged with 'kibana.**' to Elasticsearch
  # Logs are specifically stored with a prefix of 'kibana'
</match>

# Send Vault syslog logs to Elasticsearch
<match vault.syslog.**>
  @type elasticsearch
  host elastic
  port 9200
  user fluentd
  password admin
  scheme http
  logstash_format true
  logstash_prefix vault
  logstash_dateformat %Y.%m.%d
  include_tag_key true
  tag_key @log_name
  # Sends logs tagged with 'vault.syslog.**' to Elasticsearch
  # Logs are specifically stored with a prefix of 'vault'
</match>

# ==========================================
# ==                                      ==
# ==               METRICS                ==
# ==                                      ==
# ==========================================

# Send logs to Prometheus (Custom Metrics)
<match prometheus.**>
  @type prometheus
  host prometheus
  port 9090
  scheme http
  metrics_path /metrics
  # Sends logs tagged with 'prometheus.**' to Prometheus
  # Used for custom metrics collection
</match>

# Send logs to Prometheus monitoring (Fluentd internal metrics)
<match fluentd.**>
  @type prometheus
  <storage>
    @type local
    persistent true
  </storage>
  <labels>
    host ${hostname}
    fluentd_instance ${tag}
  </labels>
  <metrics>
    total_count
    uptime_seconds
  </metrics>
  # Sends Fluentd internal metrics to Prometheus
  # Collects metrics like total count and uptime seconds
</match>

# Additional metrics collection and monitoring
<match monitoring.**>
  @type prometheus
  host prometheus
  port 9090
  metrics_path /metrics
  # Sends logs tagged with 'monitoring.**' to Prometheus for additional monitoring
</match>
